<!DOCTYPE html>
<html>
  <head>
    <title>Bristol International Exhibition 1914 | A Mashup by @gothick</title>
    <meta http-equiv="imagetoolbar" content="no">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name='author' content='Matt Gibson, gothick@gothick.org.uk'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.2/leaflet.css">
    <link rel="stylesheet" href="https://cdn.rawgit.com/ardhi/Leaflet.MousePosition/master/src/L.Control.MousePosition.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.2/leaflet.js" type="text/javascript"></script>
    <script src="https://cdn.rawgit.com/ardhi/Leaflet.MousePosition/master/src/L.Control.MousePosition.js" type="text/javascript"></script>
    <style>
      body { margin:0; padding:0; width:100%; height:100%; background: #ffffff; }
      #map { position:absolute; top:0; bottom:0; width:100%; z-index: 1; }
      .controls {
        position: absolute;
        top: 30px;
        right: 40px;
        width: 300px;
        /* left: 40px; */
        z-index: 5;
        font-family: sans-serif;
        padding: 2px 10px 2px 10px;
        background: white;
        background: rgba(255,255,255,0.9);
        box-shadow: 0 0 15px rgba(0,0,0,0.2);
        border-radius: 5px;
        text-align: right;
        /* display: table-cell;
        vertical-align: middle; */
        display: flex;
        align-items: center;
        height: 30px;
        border: 1px solid cornflowerblue;
      }
      #slider {
        width: 100%;
      }
      label {
        padding-right: 5px;
      }
    </style>
  </head>
<body>
  <div id="map"></div>
  <div class="controls">
    <label for="slider">Now/1914&nbsp;Mix</label>
    <input id="slider" type="range" min="0" max="2" step="0.1" value="1" oninput="mapOpacity(this.value)">
  </div>
  <script type="text/javascript">
    var mapMinZoom = 14;
    var mapMaxZoom = 19;

    var defaltViewBounds = new L.LatLngBounds(
      new L.LatLng(51.446305, -2.628280),
      new L.LatLng(51.442819, -2.622825)
    );

    var maxBounds = new L.LatLngBounds(
      new L.LatLng(51.4510, -2.635),
      new L.LatLng(51.4350, -2.615)
    );

    // These are the options we used for gdal2tiles
    var tileBounds = new L.LatLngBounds(
      new L.LatLng(51.4490, -2.63012532448742),
      new L.LatLng(51.4400, -2.61820)
    )

    var map = L.map('map')
      .fitBounds(defaltViewBounds)
      .setMaxBounds(maxBounds);

    // L.rectangle(maxBounds).addTo(map);

    var white = L.tileLayer("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEAAQMAAABmvDolAAAAA1BMVEX///+nxBvIAAAAH0lEQVQYGe3BAQ0AAADCIPunfg43YAAAAAAAAAAA5wIhAAAB9aK9BAAAAABJRU5ErkJggg==",
      { minZoom: mapMinZoom, maxZoom: mapMaxZoom })
      .addTo(map);

    var modernLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
      { minZoom: mapMinZoom, maxZoom: mapMaxZoom })
      .addTo(map);

    var attribution = 'Mashup by <a href="https://gothick.org.uk">gothick</a>.';
    attribution += '<br />Historical map: Bristol Archives, <a href="https://archives.bristol.gov.uk/records/37165/7/3">39864/1/1: Printed plan of Bristol International Exhibition Site adjoining Ashton Avenue and River Avon, 1914</a>.';
    attribution += '<br />Map tiles generated by <a href="https://gdal.org/programs/gdal2tiles.html">GDAL2Tiles</a>, Copyright &copy; 2008 <a href="http://www.klokan.cz/">Klokan Petr Pridal</a>,  <a href="https://gdal.org">GDAL</a> &amp; <a href="http://www.osgeo.org/">OSGeo</a> <a href="http://code.google.com/soc/">GSoC</a>.';
    attribution += '<br />Modern map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>.';



    var options = {
      minZoom: mapMinZoom,
      maxZoom: mapMaxZoom,
      opacity: 1.0,
      attribution: attribution,
      tms: false,
      bounds: tileBounds // Try to avoid too many requests for tiles outside the range of our custom tiles.
    };
    var layer = L.tileLayer('{z}/{x}/{y}.png', options).addTo(map);

    map.zoomControl.setPosition('bottomright');

    function mapOpacity(sliderVal) {
      var hOpac = Math.min(sliderVal, 1.0);
      var mOpac = Math.min(2.0-sliderVal, 1.0);
      layer.setOpacity(hOpac);
      modernLayer.setOpacity(mOpac);
    }
  </script>
</body>
</html>
